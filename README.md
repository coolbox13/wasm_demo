# WASM Learning Project

A hands-on project for learning WebAssembly (WASM) with Rust — covering both **server-side** (Spin) and **browser-side** (wasm-bindgen) WASM in a single codebase.

## Architecture

The same language (Rust) compiles to `.wasm` for two completely different runtimes:

```
Your Browser                         Spin Server (server-side WASM)
┌─────────────────────┐              ┌─────────────────────────┐
│                     │──GET /──────→│ browser-files component  │
│  index.html loads   │←── HTML ─────│ (serves static files)    │
│                     │              │                          │
│  Browser downloads  │──GET /pkg/──→│ serves .wasm + .js glue  │
│  wasm_browser.wasm  │←── .wasm ────│                          │
│                     │              │                          │
│  ┌───────────────┐  │              │                          │
│  │ Client WASM   │  │              │                          │
│  │ (Rust in      │  │  "Compare"   │ ┌──────────────────────┐│
│  │  browser)     │  │──GET /api──→ │ │ wasm-api component   ││
│  │ greet()       │  │←── text ──── │ │ (your Rust handler)  ││
│  │ fibonacci()   │  │              │ │ handle_request()     ││
│  │ DOM access    │  │              │ └──────────────────────┘│
│  └───────────────┘  │              │                          │
└─────────────────────┘              └─────────────────────────┘
   wasm32-unknown-unknown               wasm32-wasip1
   ~21KB .wasm                           ~285KB .wasm
```

## Project Structure

```
wasm/
├── spin.toml              # Spin manifest (v2) — defines both components
├── Cargo.toml             # Server-side Rust crate (spin-sdk 5.1)
├── src/lib.rs             # Server-side HTTP handler (runs on server)
├── spin_static_fs.wasm    # Pre-built Spin file server component
└── browser/               # Browser-side WASM
    ├── Cargo.toml         # Browser crate (wasm-bindgen + web-sys)
    ├── src/lib.rs         # Browser functions (runs in user's browser)
    ├── index.html         # Web page that loads the browser WASM
    └── dist/              # Built output (served by Spin)
        ├── index.html
        └── pkg/
            ├── wasm_browser.js       # JS glue (generated by wasm-pack)
            └── wasm_browser_bg.wasm  # Browser WASM binary (~21KB)
```

## Server-side vs Browser-side WASM

| | Server-side (Spin) | Browser-side (wasm-bindgen) |
|---|---|---|
| **Target** | `wasm32-wasip1` | `wasm32-unknown-unknown` |
| **SDK** | `spin-sdk` | `wasm-bindgen` + `web-sys` |
| **Runs on** | Spin/Wasmtime runtime on server | Browser's built-in WASM engine |
| **Triggered by** | Incoming HTTP requests | JavaScript function calls |
| **Can access** | WASI APIs (files, env, HTTP out) | Browser APIs (DOM, console, fetch) |
| **Entry point** | `#[http_component]` macro | `#[wasm_bindgen]` macro |
| **Binary size** | ~285KB | ~21KB |

## Prerequisites

- [Rust](https://rustup.rs/) with targets:
  - `wasm32-wasip1` (server-side): `rustup target add wasm32-wasip1`
  - `wasm32-unknown-unknown` (browser): added automatically by wasm-pack
- [wasm-pack](https://rustwasm.github.io/wasm-pack/): `cargo install wasm-pack`
- [Spin CLI](https://spinframework.dev/install)

## Build & Run

### Build everything

```bash
# Build browser WASM (generates JS glue + .wasm in browser/dist/pkg/)
cd browser && wasm-pack build --target web --out-dir dist/pkg && cd ..

# Build server WASM + start the server
spin build && spin up
```

### Open in browser

Visit [http://127.0.0.1:3000](http://127.0.0.1:3000) to see:

1. **Greet buttons** — call Rust's `greet()` running in your browser
2. **Fibonacci buttons** — CPU-heavy math at near-native speed, client-side
3. **Fetch from Spin server** — calls the server-side WASM via HTTP for comparison
4. **DevTools console** — shows a log message written by Rust via `web_sys::console`

### API endpoint

```bash
curl http://127.0.0.1:3000/api
# Hello, curl/8.7.1! Your request was handled by a tiny, lightning-fast Wasm component.
```

## Key Takeaways

- **Same language** (Rust), **same output format** (.wasm), **completely different runtimes**
- Server WASM is reactive — it waits for requests and sends responses
- Browser WASM is callable — JavaScript calls your Rust functions directly
- Browser WASM is great for CPU-heavy tasks (crypto, compression, image processing, math)
- Server WASM is great for sandboxed, lightweight microservices with fast cold starts
